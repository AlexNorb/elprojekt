---
import PaperClipIcon from "./icons/PaperClipIcon.astro";
---

<form id="contact-form" class="space-y-6">
    <div>
        <label
            for="serviceType"
            class="block text-sm font-medium text-slate-700 font-display mb-1"
        >
            Ärende
        </label>
        <select
            id="serviceType"
            name="serviceType"
            class="block w-full rounded-md border-gray-300 bg-slate-50 border p-3 focus:border-elblue focus:ring-elblue sm:text-sm outline-none transition-all"
        >
            <option>Allmänt</option>
            <option>Offertförfrågan</option>
            <option>Service & Felsökning</option>
            <option>Laddbox</option>
            <option>Solceller</option>
        </select>
    </div>

    <div>
        <label
            for="name"
            class="block text-sm font-medium text-slate-700 font-display mb-1"
        >
            Namn
        </label>
        <input
            type="text"
            name="name"
            id="name"
            required
            class="block w-full rounded-md border-gray-300 bg-slate-50 border p-3 focus:border-elblue focus:ring-elblue sm:text-sm outline-none transition-all"
            placeholder="Förnamn Efternamn"
        />
    </div>

    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
        <div>
            <label
                for="email"
                class="block text-sm font-medium text-slate-700 font-display mb-1"
            >
                E-post
            </label>
            <input
                type="email"
                name="email"
                id="email"
                class="block w-full rounded-md border-gray-300 bg-slate-50 border p-3 focus:border-elblue focus:ring-elblue sm:text-sm outline-none transition-all"
                placeholder="din@email.se"
            />
        </div>
        <div>
            <label
                for="phone"
                class="block text-sm font-medium text-slate-700 font-display mb-1"
            >
                Telefon
            </label>
            <input
                type="tel"
                name="phone"
                id="phone"
                class="block w-full rounded-md border-gray-300 bg-slate-50 border p-3 focus:border-elblue focus:ring-elblue sm:text-sm outline-none transition-all"
                placeholder="070-123 45 67"
            />
        </div>
    </div>

    <div>
        <label
            for="message"
            class="block text-sm font-medium text-slate-700 font-display mb-1"
        >
            Meddelande
        </label>
        <textarea
            id="message"
            name="message"
            rows="4"
            required
            class="block w-full rounded-md border-gray-300 bg-slate-50 border p-3 focus:border-elblue focus:ring-elblue sm:text-sm outline-none transition-all"
            placeholder="Beskriv vad du behöver hjälp med..."></textarea>
    </div>

    <!-- File Upload Section -->
    <div class="flex flex-col sm:flex-row gap-4">
        <label
            for="file-upload"
            class="flex items-center justify-center w-full px-4 py-3 border border-slate-300 border-dashed rounded-md shadow-sm text-sm font-medium text-slate-600 bg-slate-50 hover:bg-slate-100 cursor-pointer transition-colors"
        >
            <PaperClipIcon className="w-5 h-5 mr-2 text-slate-400" />
            <span>Bifoga bild eller dokument</span>
            <input
                id="file-upload"
                name="file-upload"
                type="file"
                multiple
                accept="image/*,.pdf,.doc,.docx,.xls,.xlsx"
                class="sr-only"
            />
        </label>
    </div>

    <div>
        <button
            type="submit"
            class="w-full flex justify-center py-4 px-6 border border-transparent rounded-md shadow-sm text-base font-bold text-white bg-elorange hover:bg-elorange-hover focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-elorange transition-all duration-200 transform hover:-translate-y-1 font-display uppercase tracking-wider"
        >
            Skicka Förfrågan
        </button>
    </div>
</form>

<script>
    // Use querySelectorAll to handle multiple forms on page if necessary, though ID usage implies uniqueness.
    // Ideally we should use class if multiple forms could exist, but for now ID 'contact-form' is likely unique per view.
    // If logic suggests multiple forms (e.g. modal + page), ID needs to be unique or use classes.
    // Let's stick to ID for now as per original code, but cleaner logic.
    const form = document.getElementById("contact-form");
    if (form) {
        const emailInput = form.querySelector(
            'input[name="email"]',
        ) as HTMLInputElement;
        const phoneInput = form.querySelector(
            'input[name="phone"]',
        ) as HTMLInputElement;

        const validateGroup = () => {
            // Om BÅDA är tomma
            if (!phoneInput.value && !emailInput.value) {
                // Sätt ett felmeddelande på det första fältet (detta triggar bubblan vid submit)
                emailInput.setCustomValidity(
                    "Du måste fylla i antingen e-post eller telefonnummer.",
                );
            } else {
                // Om minst ett är ifyllt, rensa felet (så formuläret kan skickas)
                emailInput.setCustomValidity("");
            }
        };

        // Kör kontrollen varje gång användaren skriver något i något av fälten
        emailInput.addEventListener("input", validateGroup);
        phoneInput.addEventListener("input", validateGroup);

        // Kör en gång vid start för att sätta initialt krav
        // Vi kör den INTE direkt för att undvika valideringsfel innan användaren gjort något,
        // men webbläsaren kollar validity vid submit.
        // Dock, för att 'required'-beteendet ska kicka in korrekt vid submit om inget är ifyllt:
        validateGroup();

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Webbläsarens inbyggda validering har redan kört här (pga validateGroup).
            // Om vi är här är formuläret giltigt enligt HTML5 constraints.

            const formData = new FormData(e.target as HTMLFormElement);

            // Data extraction
            const email = formData.get("email") as string;
            const phone = formData.get("phone") as string;
            const name = formData.get("name");

            // Here you would typically send data to a backend
            alert(`Tack ${name}! Jag återkommer till dig inom kort.`);
            (e.target as HTMLFormElement).reset();
        });
    }
</script>
