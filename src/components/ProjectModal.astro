---
---
<!-- PROJECT DETAILS MODAL -->
<div id="project-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-brand-dark/90 backdrop-blur-sm" id="modal-backdrop"></div>
    
    <!-- Modal Content -->
    <div class="modal-content relative bg-white rounded shadow-2xl w-full max-w-5xl overflow-hidden flex flex-col lg:flex-row max-h-[95vh] lg:max-h-[80vh]">
        
        <!-- Close Button -->
        <button id="modal-close-btn" class="absolute top-4 right-4 z-20 w-10 h-10 bg-white rounded-full flex items-center justify-center text-slate-900 hover:text-brand-accent shadow-lg transition">
            <i class="fa-solid fa-xmark text-xl"></i>
        </button>

        <!-- Image Gallery Section (Left) -->
        <div class="w-full lg:w-3/5 h-[60vh] lg:h-auto bg-slate-100 relative flex flex-col">
            <!-- Main Image Display -->
            <div class="relative flex-grow h-full min-h-64">
                <img id="main-gallery-img" src="" alt="Projektbild i fullskärm" class="w-full h-full object-cover transition duration-300">
                
                <!-- Navigation Arrows -->
                <button id="prev-btn" class="absolute left-0 top-1/2 -translate-y-1/2 p-4 md:p-6 bg-brand-dark/50 text-white hover:bg-brand-accent transition z-10 rounded-r-md">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button id="next-btn" class="absolute right-0 top-1/2 -translate-y-1/2 p-4 md:p-6 bg-brand-dark/50 text-white hover:bg-brand-accent transition z-10 rounded-l-md">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>

            <!-- Thumbnails -->
            <div id="gallery-thumbnails" class="flex-shrink-0 bg-white p-2 border-t border-slate-100 flex overflow-x-auto space-x-2">
                <!-- Thumbnails generated by JS -->
            </div>
        </div>

        <!-- Content Section (Right) -->
        <div class="w-full lg:w-2/5 p-6 md:p-8 flex flex-col justify-between bg-white overflow-y-auto">
            <div>
                <span id="modal-category" class="text-brand-accent text-xs font-bold uppercase tracking-widest mb-2 block"></span>
                <h3 id="modal-title" class="text-2xl md:text-3xl font-bold text-slate-900 mb-6 font-display"></h3>
                
                <div class="w-12 h-1 bg-brand-primary mb-6"></div>
                
                <h4 class="text-sm font-bold text-slate-900 uppercase mb-2">Projektbeskrivning</h4>
                <p id="modal-desc" class="text-slate-600 leading-relaxed text-sm mb-8">
                    <!-- Description goes here -->
                </p>

                <div class="bg-brand-gray p-4 rounded border-l-4 border-brand-primary">
                    <p class="text-xs text-slate-500 italic"><i class="fa-solid fa-check text-brand-primary mr-2"></i> Utfört av behörig elektriker. Alltid.</p>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-100">
                <p class="text-xs text-slate-500 mb-3 text-center">Gillar du resultatet?</p>
                <a href="/#kontakt" class="block w-full text-center bg-brand-primary hover:bg-brand-dark text-white font-display font-bold py-4 rounded transition duration-300 shadow-lg text-xs uppercase tracking-widest">
                    Begär Offert på liknande
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // --- Galleri & Modal Logik ---
    const modal = document.getElementById('project-modal');
    let currentImages = []; 
    let currentIndex = 0;   

    function showImage(index) {
        if (currentImages.length === 0) return;
        
        currentIndex = (index + currentImages.length) % currentImages.length;
        
        const mainImg = document.getElementById('main-gallery-img');
        if(mainImg) mainImg.setAttribute('src', currentImages[currentIndex]);
        
        document.querySelectorAll('.thumbnail-img').forEach((thumb, i) => {
            if (i === currentIndex) {
                thumb.classList.add('border-brand-accent', 'border-4');
                thumb.classList.remove('border-slate-300', 'border-2');
            } else {
                thumb.classList.remove('border-brand-accent', 'border-4');
                thumb.classList.add('border-slate-300', 'border-2');
            }
        });

        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const display = currentImages.length <= 1 ? 'none' : 'block';
        if(prevBtn) prevBtn.style.display = display;
        if(nextBtn) nextBtn.style.display = display;
    }

    function navigateGallery(direction) {
        showImage(currentIndex + direction);
    }

    // Attach listeners to cards
    const cards = document.querySelectorAll('.project-card');
    cards.forEach(card => {
        card.addEventListener('click', () => {
            const data = JSON.parse(card.getAttribute('data-project') || '{}');
            openModal(data.title, data.category, data.desc, data.images);
        });
    });

    function openModal(title, category, desc, imageUrls) {
        const titleEl = document.getElementById('modal-title');
        const catEl = document.getElementById('modal-category');
        const descEl = document.getElementById('modal-desc');
        
        if(titleEl) titleEl.innerText = title;
        if(catEl) catEl.innerText = category;
        if(descEl) descEl.innerText = desc;

        currentImages = imageUrls;
        const thumbnailContainer = document.getElementById('gallery-thumbnails');
        if(thumbnailContainer) {
            thumbnailContainer.innerHTML = ''; 
            imageUrls.forEach((url, index) => {
                const thumbDiv = document.createElement('div');
                thumbDiv.className = 'w-16 h-16 flex-shrink-0';
                thumbDiv.innerHTML = `
                    <img src="${url}" alt="Miniatyrbild ${index + 1}" 
                         class="thumbnail-img w-full h-full object-cover rounded cursor-pointer border-2 border-slate-300 transition duration-200">
                `;
                thumbDiv.querySelector('img')?.addEventListener('click', () => showImage(index));
                thumbnailContainer.appendChild(thumbDiv);
            });
        }

        showImage(0); 

        if(modal) modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; 
    }

    function closeModal() {
        if(modal) modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    document.getElementById('modal-close-btn')?.addEventListener('click', closeModal);
    document.getElementById('modal-backdrop')?.addEventListener('click', closeModal);
    document.getElementById('prev-btn')?.addEventListener('click', () => navigateGallery(-1));
    document.getElementById('next-btn')?.addEventListener('click', () => navigateGallery(1));

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
    });
</script>

<style>
    /* Modal Animation */
    #project-modal { transition: opacity 0.3s ease; }
    #project-modal.hidden { opacity: 0; pointer-events: none; }
    #project-modal:not(.hidden) { opacity: 1; pointer-events: auto; }
    
    .modal-content { transition: transform 0.3s ease; transform: scale(0.95); }
    #project-modal:not(.hidden) .modal-content { transform: scale(1); }
</style>
